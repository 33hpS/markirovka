# üîê –°–∏—Å—Ç–µ–º–∞ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## Supabase Auth Integration

‚ö†Ô∏è **–í–∞–∂–Ω–æ:** –°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ Supabase. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –≤ [Supabase](https://supabase.com)
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   ```bash
   VITE_SUPABASE_URL=your_supabase_project_url
   VITE_SUPABASE_ANON_KEY=your_supabase_anon_key
   ```
3. –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ Supabase Dashboard –∏–ª–∏ API

### –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑:

- **Supabase Dashboard:** Authentication ‚Üí Users ‚Üí Add User
- **Supabase API:** `auth.signUp()` –º–µ—Ç–æ–¥
- **SQL:** INSERT –≤ —Ç–∞–±–ª–∏—Ü—É auth.users (–Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `user_metadata`:

```json
{
  "firstName": "–ê–ª–µ–∫—Å–∞–Ω–¥—Ä",
  "lastName": "–ü–µ—Ç—Ä–æ–≤",
  "role": "admin",
  "permissions": ["users.manage", "system.config", "audit.view"]
}
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **AuthContext** (`src/contexts/AuthContext.tsx`)
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase Auth
   - –§—É–Ω–∫—Ü–∏–∏: `login()`, `logout()`, `usePermission()`, `useRole()`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Å—Å–∏–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Supabase

2. **Login** (`src/pages/Login.tsx`)
   - –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞

3. **ProtectedRoute** (`src/routes/ProtectedRoute.tsx`)
   - –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤ –æ—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/login` —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∏—Å—Ö–æ–¥–Ω–æ–≥–æ URL
   - –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏

4. **–°–µ—Ä–≤–∏—Å—ã**
   - `src/services/supabaseService.ts` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Supabase
   - `src/config/config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase

### –ü–æ—Ç–æ–∫ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç email/–ø–∞—Ä–æ–ª—å ‚Üí `Login.tsx`
2. –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `login()` –∏–∑ AuthContext
3. AuthContext –≤—ã–∑—ã–≤–∞–µ—Ç `supabase.signIn(email, password)`
4. Supabase –ø—Ä–æ–≤–µ—Ä—è–µ—Ç credentials –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç session
5. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ user metadata (—Ä–æ–ª—å, –ø—Ä–∞–≤–∞, –∏–º—è)
6. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
7. –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ –∑–∞—â–∏—â—ë–Ω–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç

### –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

**Supabase Auth:**

- ‚úÖ –†–µ–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—á—ë—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º refresh
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–µ—Å—Å–∏–π
- ‚úÖ Built-in –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
- ‚úÖ Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- ‚úÖ Password reset flow (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π:

1. **Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è:**

   ```typescript
   await supabase.auth.signUp({
     email,
     password,
     options: { emailRedirectTo: 'https://yourapp.com/verify' },
   });
   ```

2. **Password reset:**

   ```typescript
   await supabase.auth.resetPasswordForEmail(email, {
     redirectTo: 'https://yourapp.com/reset-password',
   });
   ```

3. **OAuth –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã:**
   ```typescript
   await supabase.auth.signInWithOAuth({
     provider: 'google', // –∏–ª–∏ 'github', 'gitlab', etc.
   });
   ```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ **JWT —Ç–æ–∫–µ–Ω—ã** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Supabase
- ‚úÖ **Refresh tokens** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–µ–∑ logout
- ‚úÖ **Secure storage** - Supabase –∏—Å–ø–æ–ª—å–∑—É–µ—Ç httpOnly cookies
- ‚úÖ **CSRF protection** - Built-in –∑–∞—â–∏—Ç–∞ –≤ Supabase
- ‚úÖ **Rate limiting** - –ó–∞—â–∏—Ç–∞ –æ—Ç brute-force –∞—Ç–∞–∫
- ‚úÖ **Password policies** - –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–∞—Ä–æ–ª—è–º
- ‚úÖ **–ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤** - –ß–µ—Ä–µ–∑ ProtectedRoute –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
- ‚úÖ **Role-based permissions** - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ user_metadata

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. **–í–∫–ª—é—á–∏—Ç–µ email verification** –≤ production
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ Row Level Security (RLS)** –≤ Supabase –¥–ª—è —Ç–∞–±–ª–∏—Ü
4. **–•—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã** –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è, –Ω–µ –≤ –∫–æ–¥–µ
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ** –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ Supabase SDK

## Deployment

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–¥–µ–ø–ª–æ–µ–Ω–æ –Ω–∞ Cloudflare Workers: **URL:** https://markirovka.sherhan1988hp.workers.dev

### –ö–æ–º–∞–Ω–¥—ã

```bash
# –°–±–æ—Ä–∫–∞
npm run build

# –õ–æ–∫–∞–ª—å–Ω—ã–π dev —Å–µ—Ä–≤–µ—Ä
npm run dev

# –î–µ–ø–ª–æ–π –Ω–∞ Cloudflare Workers
npm run deploy:worker
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Backend API**
   - –ó–∞–º–µ–Ω–∏—Ç—å mock login –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π API endpoint
   - –î–æ–±–∞–≤–∏—Ç—å refresh token flow
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å logout –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

2. **UI Improvements**
   - –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É logout –≤ Navigation
   - –û—Ç–æ–±—Ä–∞–∂–∞—Ç—å –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ header
   - –î–æ–±–∞–≤–∏—Ç—å "Remember me" checkbox
   - Password reset flow

3. **Security Enhancements**
   - –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ httpOnly cookies –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤
   - –î–æ–±–∞–≤–∏—Ç—å rate limiting –¥–ª—è login
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å session timeout warnings
   - 2FA –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

4. **Permissions**
   - –°–∫—Ä—ã—Ç–∏–µ UI —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–æ –ø—Ä–∞–≤–∞–º
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ backend
   - –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
